<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Tasks</title> 
    <style>
    
    #task_parameters {
        display:none;
        position: absolute;
        left: 300px;
        width: 400px;
        top: 0;
    }

    .selected {
        border: 1px solid gray;
    }

    #type div, #task div  {
        display: inline-block;

    }
    
    </style>
 
  
</head>
<body>
    
    <div id="tasks">
        <div id="new_task">+ NEW TASK</div> 
        <div id="created_tasks">
    </div>
    <div id="task_parameters">
        <div>
            <p>TASK SUMMARY</p>
            <div id="summary"></div>
            <button></button>>
        </div>
        <div >
            <p>TASK LOCTION</p>
            <input type = 'text' id = 'location'></input>
        </div>
        <div id = "type">
            <p>SERVICE TYPE</p>
        </div>
        <div id = "task">
            <p></p>
        </div>
        <div> 
            <p>TASK DESCRIPTION</p>
            <input type = 'text' id = 'description'></input>
        </div>        
    </div>





    <script>

            var taskTypes = [
                {
                    type: 'Electrician',
                    tasks: ['Fix light', 'Fix something else']
                },
                {
                    type: 'Plumber',
                    tasks: ['Unlock a toilet', 'Unlock a sink', 'Fix water leak']
                },
                {
                    type: 'Housekeeper',
                    tasks: ['Iron closes', 'Clean bathroom', 'Cook dinner']
                }
            ]
            
            
            function getTasks() {
                let xhr = new XMLHttpRequest();
                xhr.open('GET', 'http://localhost:3333/alltasks', true) ;
                xhr.onload = function(){
                    var createdTasks = JSON.parse(this.response);
                    
                    var createdTasksDivs;
                    
                    var createdTasksBlock = document.getElementById('created_tasks');
                    
                    createdTasksDivs = new Array;
                    
                    for (i in createdTasks){
                       
                        createdTasksDivs[i] = document.createElement('div'); 
                        let taskDate = parseDate(createdTasks[i].id);   
                        
                        let text = `<div id=${createdTasks[i].id}><div class='date'>${taskDate}</div><div class='description'>${createdTasks[i].description}</div><div class='buttons'><button>Edit</button><button>Delete</button></div></div>`; 
                       
                       createdTasksDivs[i].innerHTML = text;
                        
                        createdTasksBlock.append(createdTasksDivs[i]);                      
                    }                    
                    
                }
                xhr.send();
            }
            
            function parseDate(dateString){
             let dateAsDate = new Date(Number(dateString));  
             let months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'Augest', 'September', 'October', 'November', 'December'];
             let days = ['Sunday', 'Monday', 'Tuesday', 'Wednesay', 'Thursday', 'Friday', 'Saturday'];
             let month = months[dateAsDate.getMonth()];
             let day = days[dateAsDate.getDay()];
             let monthDay = dateAsDate.getDate();
             let hours = dateAsDate.getHours() < 10 ? '0' + dateAsDate.getHours() : dateAsDate.getHours();
             let minutes = dateAsDate.getMinutes() < 10 ? '0' + dateAsDate.getMinutes() : dateAsDate.getMinutes();
             let seconds = dateAsDate.getSeconds() < 10 ? '0' + dateAsDate.getSeconds() : dateAsDate.getSeconds();  
             return `${day},${month} ${monthDay}, ${hours}:${minutes}`;
            }


            function createTask() {
                var taskType;
                var taskSubtype;
                var taskDescription;
                var taskLocation;
                let createTaskButton =  document.getElementById('summary').querySelector('button');

                let newTaskButton =  document.getElementById('new_task')
                console.log(newTaskButton);
                createTaskButton.innerText = 'CREATE TASK';

                createTaskButton.addEventListener('click', addTask, true);
                    
                function addTask(){


                  taskDescription = document.getElementById().innerText;
                  
                  





                    let xhr = new XMLHttpRequest();
                xhr.open('GET', 'http://localhost:3333/alltasks', true) ;
                xhr.onload = function(){
                    var createdTasks = JSON.parse(this.response);
                    
                    var createdTasksDivs;
                    
                    var createdTasksBlock = document.getElementById('created_tasks');
                    
                    createdTasksDivs = new Array;
                    
                    for (i in createdTasks){
                       
                        createdTasksDivs[i] = document.createElement('div'); 
                        let taskDate = parseDate(createdTasks[i].id);   
                        
                        let text = `<div id=${createdTasks[i].id}><div class='date'>${taskDate}</div><div class='description'>${createdTasks[i].description}</div><div class='buttons'><button>Edit</button><button>Delete</button></div></div>`; 
                       
                       createdTasksDivs[i].innerHTML = text;
                        
                        createdTasksBlock.append(createdTasksDivs[i]);                      
                    }                    
                    
                }
                xhr.send();






                    ////////
                }

               newTaskButton.addEventListener('click', showNewTaskOptions, true);

               function showNewTaskOptions(action) {
                    document.getElementById('task_parameters').style.display = 'block';

                    let taskOptions = document.getElementById('type');
                    var taskTypeDivs = new Array;

                    for (let i in taskTypes) {
                        taskTypeDivs[i] = document.createElement('div');
                        taskTypeDivs[i].innerHTML = taskTypes[i].type;
                        taskTypeDivs[i].addEventListener('click', selectType, true);
                        taskOptions.append(taskTypeDivs[i]);    
                    }

                    

                    function selectType(e) {
                        e.preventDefault();
                        taskType = e.currentTarget.innerText;
                        e.currentTarget.setAttribute('class','selected');
                        document.getElementById('summary').innerText = getTaskSummary();
                        showSubtypes(taskType);
                    } 
                    
                    function showSubtypes(selectedType){
                        var subTypesDiv = document.getElementById('task');
                        subTypesDiv.innerHTML = '';
                        let title = document.createElement('p');
                        subTypesDiv.append(title);
                        title.innerText = `${taskType.toUpperCase()} TASKS`;
                        var selectedSubtypes = taskTypes.find(task => task.type === selectedType);
                        var subTypesDivs = new Array;
                        
                        for (let i in selectedSubtypes.tasks) {
                            subTypesDivs[i] = document.createElement('div');
                            subTypesDivs[i].innerHTML =  selectedSubtypes.tasks[i];
                            subTypesDivs[i].addEventListener('click', selectSubType, true);
                            subTypesDiv.append(subTypesDivs[i]); 
                        }

                    }

                    function selectSubType(e) {
                        e.preventDefault();
                        taskSubtype = e.currentTarget.innerText;
                        e.currentTarget.setAttribute('class','selected'); 
                        document.getElementById('summary').innerText = getTaskSummary();                       
                    }
                

                }


                document.getElementById('description').addEventListener('change', e => {
                    e.preventDefault();
                    document.getElementById('summary').innerText = getTaskSummary();
                })

                function getTaskSummary(){
                    var taskLocation = document.getdocumentById('location').innerText;
                    var taskDescription = document.getElementById('description').innerText;
                    return `I need a ${taskType} to ${taskSubtype}, ${taskDescription}`;
                }

            }

            

            

            
            getTasks();
            createTask();
            
            
              </script>

    
</body>
</html>